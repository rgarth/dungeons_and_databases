<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D&D Race Avatar Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1e293b;
            color: white;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-button {
            background-color: #7c3aed;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin-bottom: 20px;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }
        .test-button:hover {
            background-color: #6d28d9;
        }
        .test-button:disabled {
            background-color: #64748b;
            cursor: not-allowed;
        }
        .controls {
            text-align: center;
            margin-bottom: 20px;
        }
        .race-selector {
            margin-top: 20px;
            padding: 20px;
            background-color: #334155;
            border-radius: 8px;
            display: inline-block;
        }
        .race-selector label {
            display: block;
            margin-bottom: 10px;
            font-weight: bold;
        }
        .race-selector select {
            padding: 8px 12px;
            border-radius: 4px;
            border: 1px solid #64748b;
            background-color: #1e293b;
            color: white;
            margin-right: 10px;
            min-width: 150px;
        }
        .test-single-button {
            background-color: #059669;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-single-button:hover:not(:disabled) {
            background-color: #047857;
        }
        .test-single-button:disabled {
            background-color: #64748b;
            cursor: not-allowed;
        }
        .results {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        .race-result {
            background-color: #334155;
            border-radius: 8px;
            padding: 15px;
            border: 2px solid transparent;
        }
        .race-result.success {
            border-color: #10b981;
        }
        .race-result.error {
            border-color: #ef4444;
        }
        .race-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .race-status {
            margin-bottom: 10px;
        }
        .race-image {
            width: 100%;
            max-width: 200px;
            height: auto;
            border-radius: 4px;
            margin-bottom: 10px;
        }
        .race-time {
            font-size: 12px;
            color: #94a3b8;
        }
        .loading {
            text-align: center;
            color: #94a3b8;
            margin: 20px 0;
        }
        .summary {
            background-color: #334155;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }
        .success-count {
            color: #10b981;
            font-size: 24px;
            font-weight: bold;
        }
        .error-count {
            color: #ef4444;
            font-size: 24px;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1>üé≠ D&D Race Avatar Test</h1>
        <p>Test FLUX.1 Schnell avatar generation for all available races</p>
        <p><strong>‚ö†Ô∏è Development Tool Only - Not Available in Production</strong></p>
    </div>

    <div class="controls">
        <button id="testButton" class="test-button">
            üöÄ Test All Races with FLUX.1 Schnell
        </button>
        
        <div class="race-selector">
            <label for="raceSelect">Or test individual race:</label>
            <select id="raceSelect">
                <option value="">Select a race...</option>
                <option value="Aasimar">Aasimar</option>
                <option value="Dragonborn">Dragonborn</option>
                <option value="Dwarf">Dwarf</option>
                <option value="Elf">Elf</option>
                <option value="Gnome">Gnome</option>
                <option value="Goliath">Goliath</option>
                <option value="Half-Elf">Half-Elf</option>
                <option value="Halfling">Halfling</option>
                <option value="Half-Orc">Half-Orc</option>
                <option value="Human">Human</option>
                <option value="Tabaxi">Tabaxi</option>
                <option value="Tiefling">Tiefling</option>
            </select>
            <button id="testSingleButton" class="test-single-button" disabled>üé® Generate Single Race</button>
        </div>
    </div>

    <div id="summary" class="summary" style="display: none;">
        <h3>Test Results Summary</h3>
        <div>
            <span class="success-count" id="successCount">0</span> successful / 
            <span class="error-count" id="errorCount">0</span> failed
        </div>
    </div>

    <div id="loading" class="loading" style="display: none;">
        <p>üé® Generating avatars for all races... This may take a few minutes.</p>
        <p>Each race will appear below as it completes.</p>
    </div>

    <div id="results" class="results"></div>

    <script>
        document.getElementById('testButton').addEventListener('click', async function() {
            const button = this;
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const summary = document.getElementById('summary');
            
            button.disabled = true;
            button.textContent = 'üé® Testing...';
            loading.style.display = 'block';
            results.innerHTML = '';
            summary.style.display = 'none';
            
            try {
                const response = await fetch('http://localhost:3000/api/test-races-avatar');
                const data = await response.json();
                
                loading.style.display = 'none';
                summary.style.display = 'block';
                
                if (data.results) {
                    document.getElementById('successCount').textContent = data.summary.successful;
                    document.getElementById('errorCount').textContent = data.summary.failed;
                    
                    data.results.forEach(result => {
                        const raceDiv = document.createElement('div');
                        raceDiv.className = `race-result ${result.success ? 'success' : 'error'}`;
                        
                        raceDiv.innerHTML = `
                            <div class="race-name">${result.race}</div>
                            <div class="race-status">
                                ${result.success ? '‚úÖ Success' : '‚ùå Failed'}
                            </div>
                            ${result.success && result.imageUrl ? 
                                `<img src="${result.imageUrl}" alt="${result.race} avatar" class="race-image">` : 
                                ''
                            }
                            ${result.error ? `<div style="color: #ef4444; font-size: 12px;">${result.error}</div>` : ''}
                            <div class="race-time">${result.generationTime}ms</div>
                        `;
                        
                        results.appendChild(raceDiv);
                    });
                } else {
                    results.innerHTML = `<div class="race-result error">
                        <div class="race-name">Test Failed</div>
                        <div style="color: #ef4444;">${data.error || 'Unknown error'}</div>
                    </div>`;
                }
            } catch (error) {
                loading.style.display = 'none';
                results.innerHTML = `<div class="race-result error">
                    <div class="race-name">Network Error</div>
                    <div style="color: #ef4444;">${error.message}</div>
                </div>`;
            }
            
            button.disabled = false;
            button.textContent = 'üöÄ Test All Races with FLUX.1 Schnell';
        });

        // Single race selector functionality
        const raceSelect = document.getElementById('raceSelect');
        const testSingleButton = document.getElementById('testSingleButton');

        raceSelect.addEventListener('change', function() {
            testSingleButton.disabled = !this.value;
        });

        testSingleButton.addEventListener('click', async function() {
            const selectedRace = raceSelect.value;
            if (!selectedRace) return;

            const button = this;
            const loading = document.getElementById('loading');
            const results = document.getElementById('results');
            const summary = document.getElementById('summary');
            
            button.disabled = true;
            button.textContent = 'üé® Generating...';
            loading.style.display = 'block';
            loading.innerHTML = `<p>üé® Generating avatar for ${selectedRace}...</p>`;
            results.innerHTML = '';
            summary.style.display = 'none';
            
            try {
                const response = await fetch('http://localhost:3000/api/test-single-race-avatar', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ race: selectedRace })
                });
                
                const data = await response.json();
                
                loading.style.display = 'none';
                
                if (data.success) {
                    const raceDiv = document.createElement('div');
                    raceDiv.className = 'race-result success';
                    
                    raceDiv.innerHTML = `
                        <div class="race-name">${data.race}</div>
                        <div class="race-status">‚úÖ Success</div>
                        <img src="${data.imageUrl}" alt="${data.race} avatar" class="race-image">
                        <div class="race-time">${data.generationTime}ms</div>
                    `;
                    
                    results.appendChild(raceDiv);
                } else {
                    results.innerHTML = `<div class="race-result error">
                        <div class="race-name">${selectedRace}</div>
                        <div class="race-status">‚ùå Failed</div>
                        <div style="color: #ef4444; font-size: 12px;">${data.error || data.details || 'Unknown error'}</div>
                    </div>`;
                }
            } catch (error) {
                loading.style.display = 'none';
                results.innerHTML = `<div class="race-result error">
                    <div class="race-name">${selectedRace}</div>
                    <div class="race-status">‚ùå Network Error</div>
                    <div style="color: #ef4444; font-size: 12px;">${error.message}</div>
                </div>`;
            }
            
            button.disabled = false;
            button.textContent = 'üé® Generate Single Race';
        });
    </script>
</body>
</html> 